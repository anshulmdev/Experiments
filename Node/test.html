<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Relatel Live Example</title>

  <style>
    section {
      display: inline-block;
      max-width: 500px;
      vertical-align: top;
      word-break: break-word;
    }
  </style>

  <script>
    // Embed the Faye browser client code from http://faye.jcoglan.com/ here.
  </script>
  <script>
    // Your info here. The employee must be part of the company.
    var COMPANY_ID = 1234; // Find your `company_id` via the employee endpoint: https://app.relatel.dk/api/v2/employee.json
    var EMPLOYEE_ACCESS_TOKEN = 'secret'; // See our authentication guide for info on where to get this.

    document.addEventListener("DOMContentLoaded", function () {
      var client = new Faye.Client('https://pubsub.firmafon.dk/faye');
      Faye.logger = window.console; // Get details about subscribing, unsubscribing etc.

      // Add an extension to always send along the `access_token` as well as an app reference
      // to your app name.
      client.addExtension({
        outgoing: function (message, callback) {
          message.ext = { app: 'relatel.live.example', access_token: EMPLOYEE_ACCESS_TOKEN };
          callback(message);
        }
      });

      // Presence shows when employees and employee groups within a company are available or busy.
      client.subscribe('/presence/company/' + COMPANY_ID, function (message) {
        var element = document.createElement('p');
        element.innerHTML = JSON.stringify(message);
        document.getElementById('presence').appendChild(element);
      });

      // Get call2 events about new calls coming in or an existing one is hung up for instance.
      client.subscribe('/call2/company/' + COMPANY_ID, function (message) {
        var element = document.createElement('p');
        element.innerHTML = JSON.stringify(message);
        document.getElementById('calls').appendChild(element);
      });
    });
  </script>
</head>
<body>
  <section id="calls"></section>
  <section id="presence"></section>
</body>
</html>